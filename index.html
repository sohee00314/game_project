<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Going Home at Night</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/Maps.js"></script>
    <script src="js/GamePlatform.js"></script>
    <script src="js/Character.js"></script>
    <script src="lib/common.js"></script>
    <script src="js/Sensor.js"></script>
    <script src="js/UpSensor.js"></script>
    <script src="js/RightSensor.js"></script>
    <script src="js/DownSensor.js"></script>
    <script src="js/LeftSensor.js"></script>
    <script>
    let level = 0; 
    let map = maps[level];
    let character;
    let platAarray = [];
    let speed = 2;
    let st =null;
        // 발판생성
        function createPF(level){
            for(let i =0;i<map.length;i++){
                for(let j=0;j<map[i].length;j++){
                    let stage = document.getElementById("stage");
                    //let src = null;
                    if(map[i][j] ==1){
                      let plate= new GamePlatfrom(stage,j*100,i*100,101,100,"red");
                      platAarray.push(plate);
                    }
                }
            }
        }
        function createCh(level){
            for(let i =0;i<map.length;i++){
                for(let j=0;j<map[i].length;j++){
                    let stage = document.getElementById("stage");
                    //let src = null;
                    if(map[i][j] ==2){
                        character = new Character(stage,j*100,i*100,90,90,0,0,"lightblue");
                    }
                }
            }

        }
        function gameLoop(){
            character.tick();
            character.render();
            
        }
        function play(){
            if(st==null){
                st = setInterval(gameLoop,10);
            } else{
                clearInterval(st);
                st =null;
            }

        }
        function init(){
            createPF(level);
            createCh(level);
            addEventListener("keydown",function(e){
                switch(e.keyCode){
                    case 38 :character.velY= -speed; break;
                    case 39 :character.velX= speed; break;
                    case 40 :character.velY= speed; break;
                    case 37 :character.velX= -speed; break;
                    case 27 : play(); break;
                }
            });
            addEventListener("keyup",function(e){
                switch(e.keyCode){
                    case 38 :character.velY= 0; break;
                    case 39 :character.velX= 0; break;
                    case 40 :character.velY= 0; break;
                    case 37 :character.velX= 0; break;
                }
            });

        }
        addEventListener("load",function(){
            init();
        });
    </script>
</head>
<body>
    <div id="stage"></div>
</body>
</html>